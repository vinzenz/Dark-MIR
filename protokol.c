#include "program.h"
#include "protokol.h"
#include "client.h"
#include "lod.h"


unsigned char tbuff[BUFF_SIZE];
unsigned char rbuff[BUFF_SIZE];

// =============================================================================
// Client side protokol module
// =============================================================================

// =============================================================================
//==============================================================================
int New_client(){
//==============================================================================
	unsigned char *tp=NULL;
	tp=tbuff;

	*tp = P_NEW_PLAYER;
	tp++;
	strncpy((char *) tp, (char *) nick, NICKNAME_MAX);

	printf("tbuff[0]: 0x%X\n",tbuff[0]);
	printf("tbuff+1: %s\n", tp);

	SEND;

	RECV;

	if(rbuff[0] == P_NEW_PLAYER)
  		return OK;
	else
  		return FAIL;

}

//==============================================================================
int Logout(){
//==============================================================================
	unsigned char *tp=NULL;
	tp=tbuff;

	*tp = P_LOGOUT;
	tp++;
	strcpy((char *) tp, "... leaving ...\n");

	printf("tbuff[0]: 0x%X\n",tbuff[0]);
	printf("tbuff+1: %s\n", tp);

	SEND;

  return OK;
}

//==============================================================================
int Speed_up(){
//==============================================================================
	unsigned char *tp=NULL;
	tp=tbuff;

	*tp = P_SPEED_UP;
	tp++;

	printf("tbuff[0]: 0x%X\n",tbuff[0]);

	SEND;
	return OK;
}

//==============================================================================
int Slow_down(){
//==============================================================================
	unsigned char *tp=NULL;
	tp=tbuff;

	*tp = P_SLOW_DOWN;
	tp++;
	printf("tbuff[0]: 0x%X\n",tbuff[0]);

	SEND;
	return OK;
}

//==============================================================================
int Rotate_L(){
//==============================================================================
	unsigned char *tp=NULL;
	tp=tbuff;

	*tp = P_ROTATE_L;
	tp++;
	printf("tbuff[0]: 0x%X\n",tbuff[0]);

	SEND;
	return OK;
}

//==============================================================================
int Rotate_R(){
//==============================================================================
	unsigned char *tp=NULL;
	tp=tbuff;

	*tp = P_ROTATE_R;
	tp++;
	printf("tbuff[0]: 0x%X\n",tbuff[0]);

	SEND;
	return OK;
}

//==============================================================================
//==============================================================================
int Shift_L(){
//==============================================================================
	unsigned char *tp=NULL;
	tp=tbuff;

	*tp = P_SHIFT_L;
	tp++;
	printf("tbuff[0]: 0x%X\n",tbuff[0]);

	SEND;
	return OK;
}
//==============================================================================
int Shift_R(){
//==============================================================================
	unsigned char *tp=NULL;
	tp=tbuff;

	*tp = P_SHIFT_R;
	tp++;
	printf("tbuff[0]: 0x%X\n",tbuff[0]);

	SEND;
	return OK;
}


//==============================================================================
int Get_ship_state(){
//==============================================================================
	RECV;

	unsigned char *tp = rbuff;
	//if(*tp == P_STATE){
		tp++;	
		my_ship->X = *( (float *)tp);
		tp += sizeof(float);
		my_ship->Y = *( (float *)tp);
		tp += sizeof(float);
		my_ship->speed = *( (float *)tp);
		tp += sizeof(float);
		my_ship->angle = *( (float *)tp);
	printf("STATE RECIVED\n");			
	//}
	return OK;
}
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
// =============================================================================
